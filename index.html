<!DOCTYPE html>
<html lang="zh-TW" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>è²¡å‹™è‡ªç”±çµ‚æ¥µå„€è¡¨æ¿ (Privacy & Water Level)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --bg-body: #f8fafc;
      --bg-card: #ffffff;
      --text-main: #0f172a;
      --text-sub: #64748b;
      
      --c-safe: #10b981;    /* ç¶  */
      --c-warn: #f59e0b;    /* æ©˜é»ƒ */
      --c-danger: #ef4444;  /* ç´… */
      --c-blue: #3b82f6;
      --c-purple: #8b5cf6;
      --c-gold: #eab308;
      --c-orange: #f97316;
      
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] {
      --bg-body: #0f172a;
      --bg-card: #1e293b;
      --text-main: #f8fafc;
      --text-sub: #94a3b8;
    }

    * { box-sizing: border-box; outline: none; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg-body); color: var(--text-main); margin: 0; padding: 15px; transition: 0.3s; }
    
    #dashboard-container { max-width: 1600px; margin: 0 auto; background: var(--bg-body); padding: 10px; }

    /* Header */
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .btn-group button { background: var(--bg-card); border: 1px solid var(--text-sub); color: var(--text-main); padding: 8px 15px; border-radius: 6px; cursor: pointer; margin-left:5px; font-weight:bold; transition:0.2s;}
    .btn-group button:hover { background: var(--c-blue); color: white; border-color: var(--c-blue); }
    .btn-pdf { border-color: var(--c-danger) !important; color: var(--c-danger) !important; }
    .btn-pdf:hover { background: var(--c-danger) !important; color: white !important; }
    /* éš±ç§æŒ‰éˆ• */
    .btn-privacy { border-color: var(--text-main) !important; }
    .btn-privacy.active { background: var(--text-main); color: var(--bg-card); }

    /* Hero Section */
    .hero-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
    .hero-card { background: var(--bg-card); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); border-top: 4px solid var(--c-blue); }
    .hero-title { font-size: 0.9rem; color: var(--text-sub); font-weight: 600; margin-bottom: 5px; }
    .hero-val { font-size: 1.8rem; font-weight: 800; }
    .hero-sub { font-size: 0.8rem; opacity: 0.8; margin-top: 5px; line-height: 1.4; }

    /* Charts Section */
    .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .chart-card { background: var(--bg-card); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); height: 380px; page-break-inside: avoid; }
    .chart-box { position: relative; height: 320px; width: 100%; }

    /* Main Layout */
    .main-layout { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; }
    
    /* Asset Table */
    .section-card { background: var(--bg-card); border-radius: var(--radius); box-shadow: var(--shadow); padding: 20px; margin-bottom: 20px; page-break-inside: avoid; }
    .section-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--bg-body); display: flex; justify-content: space-between; align-items: center; }

    .table-container { overflow-x: auto; }
    .asset-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 800px; }
    .asset-table th { text-align: left; padding: 10px; color: var(--text-sub); border-bottom: 2px solid var(--bg-body); white-space: nowrap; }
    .asset-table td { padding: 12px 10px; border-bottom: 1px solid #f1f5f9; vertical-align: top; }
    
    /* Inputs inside table */
    .inp-group { display: flex; flex-direction: column; gap: 5px; }
    .inp-label { font-size: 0.75rem; color: var(--text-sub); }
    input[type="number"] { width: 95px; padding: 6px; border: 1px solid #cbd5e1; border-radius: 4px; text-align: right; font-weight: 600; background: var(--bg-body); color: var(--text-main); transition:0.2s; }
    input[type="number"]:focus { border-color: var(--c-blue); background: #fff; }
    input.sm { width: 60px; font-size: 0.85rem; }

    /* Water Level Bar Styles */
    .water-track {
        position: relative;
        width: 100%;
        height: 12px;
        background: #e2e8f0;
        border-radius: 6px;
        margin-top: 8px;
        overflow: hidden;
    }
    .water-fill {
        height: 100%;
        background: var(--c-safe);
        border-radius: 6px;
        transition: width 0.5s ease, background 0.3s;
    }
    .water-mark {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 2px;
        z-index: 2;
    }
    .mark-mc { background: var(--c-warn); box-shadow: 0 0 2px rgba(0,0,0,0.2); }
    .mark-liq { background: var(--c-danger); box-shadow: 0 0 2px rgba(0,0,0,0.2); }

    /* Tags & Status */
    .badge { padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; display: inline-block; }
    .b-safe { background: rgba(16,185,129,0.15); color: var(--c-safe); }
    .b-warn { background: rgba(245,158,11,0.15); color: var(--c-warn); }
    .b-danger { background: rgba(239,68,68,0.15); color: var(--c-danger); }
    
    .rule-tag { font-size: 0.75rem; color: var(--text-sub); background: #f1f5f9; padding: 2px 6px; border-radius: 4px; margin-top: 4px; display: inline-block; border:1px solid #e2e8f0; }

    .risk-lines { display: flex; flex-direction: column; gap: 6px; font-size: 0.85rem; margin-top: 8px; }
    .risk-row { display: flex; justify-content: space-between; align-items: center; background:rgba(0,0,0,0.02); padding:4px 6px; border-radius:4px; }
    .line-val { font-weight: bold; }
    .line-trigger { font-weight: 800; margin-left:4px; }
    .line-label { color: var(--text-sub); display:flex; align-items:center; gap:4px; font-size:0.85rem;}

    /* Slider */
    .sim-control { background: linear-gradient(to right, rgba(239,68,68,0.05), rgba(239,68,68,0.01)); border: 1px solid rgba(239,68,68,0.15); padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px; }
    .range-wrap { display: flex; align-items: center; gap: 15px; }
    input[type=range] { flex: 1; height: 6px; border-radius: 5px; background: #cbd5e1; outline: none; -webkit-appearance: none; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--c-danger); cursor: pointer; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

    /* Side Panel */
    .side-panel { display: flex; flex-direction: column; gap: 20px; }
    .summary-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
    .summary-val { font-weight: 700; }
    .total-line { border-top: 2px solid #eee; padding-top: 10px; margin-top: 5px; font-size: 1.1rem; }

    /* AI Advice */
    .ai-box { background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%); border: 1px solid #bfdbfe; padding: 20px; border-radius: 12px; margin-top: 20px; position: relative; overflow: hidden; page-break-inside: avoid; }
    [data-theme="dark"] .ai-box { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-color: #334155; }
    .ai-title { display: flex; align-items: center; gap: 10px; font-weight: bold; color: var(--c-blue); font-size: 1.1rem; margin-bottom: 10px; }
    .ai-content { font-size: 0.95rem; line-height: 1.6; color: var(--text-main); margin-bottom: 15px; }
    .ai-icon-bg { position: absolute; right: -10px; bottom: -20px; font-size: 6rem; opacity: 0.05; color: var(--c-blue); transform: rotate(-15deg); }

    details { background: rgba(255,255,255,0.5); border: 1px solid rgba(0,0,0,0.05); border-radius: 8px; margin-bottom: 8px; overflow: hidden; transition: 0.3s; page-break-inside: avoid; }
    details summary { padding: 10px 15px; cursor: pointer; font-weight: 600; font-size: 0.9rem; color: var(--text-sub); display: flex; align-items: center; gap: 8px; outline: none; }
    details summary:hover { background: rgba(0,0,0,0.02); color: var(--c-blue); }
    details[open] { background: rgba(255,255,255,0.8); box-shadow: 0 4px 6px -2px rgba(0,0,0,0.05); }
    details p { padding: 0 15px 15px 15px; margin: 0; font-size: 0.9rem; color: var(--text-main); line-height: 1.6; border-top: 1px solid rgba(0,0,0,0.05); margin-top: 5px; padding-top: 10px; }
    .highlight-val { color: var(--c-blue); font-weight: bold; }

    /* PRIVACY MODE STYLES */
    body.privacy-mode input[type="number"],
    body.privacy-mode .privacy-blur {
        color: transparent !important;
        text-shadow: 0 0 8px rgba(0,0,0,0.5);
        cursor: default;
    }
    body.privacy-mode input[type="number"]:focus {
        color: var(--text-main) !important;
        text-shadow: none;
    }

    @media (max-width: 1200px) {
      .hero-grid { grid-template-columns: 1fr 1fr; }
      .charts-grid { grid-template-columns: 1fr; }
      .main-layout { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<div class="container" id="dashboard-container">
  
  <div class="header">
    <div>
      <h1 style="margin:0; color:var(--c-blue)"><i class="fas fa-university"></i> è²¡å‹™è‡ªç”±çµ‚æ¥µå„€è¡¨æ¿</h1>
      <span style="font-size:0.85rem; color:var(--text-sub)">éš±ç§æ¨¡å¼ã€é¢¨éšªæ°´ä½åœ–ã€è‚¡ç½æ¨¡æ“¬ã€AI é¡§å•</span>
    </div>
    <div class="btn-group" data-html2canvas-ignore="true">
      <button onclick="togglePrivacy()" id="btnPrivacy" class="btn-privacy"><i class="fas fa-eye"></i> éš±è—é‡‘é¡</button>
      <button onclick="toggleTheme()"><i class="fas fa-adjust"></i> æ¨¡å¼</button>
      <button onclick="saveData()"><i class="fas fa-save"></i> å­˜æª”</button>
      <button onclick="calc()"><i class="fas fa-sync"></i> é‡ç®—</button>
      <button onclick="exportPDF()" class="btn-pdf"><i class="fas fa-file-pdf"></i> åŒ¯å‡º PDF</button>
    </div>
  </div>

  <!-- 1. æ ¸å¿ƒæ•¸æ“š -->
  <div class="hero-grid">
    <div class="hero-card">
      <div class="hero-title">çœŸå¯¦æ·¨è³‡ç”¢ (True Net Worth)</div>
      <div class="hero-val privacy-blur" style="color:var(--c-blue)"><span id="val_net_worth">0</span> è¬</div>
      <div class="hero-sub">ç¸½è³‡ç”¢ <span id="val_assets" class="privacy-blur">0</span> ï¼ ç¸½è² å‚µ <span id="val_liabilities" class="privacy-blur">0</span><br>(å«æˆ¿è²¸/ä¿¡è²¸æœ¬é‡‘)</div>
    </div>
    
    <div class="hero-card" style="border-top-color: var(--c-safe);">
      <div class="hero-title">æ¯æœˆæ·¨ç¾é‡‘æµ (Cash Flow)</div>
      <div class="hero-val privacy-blur" style="color:var(--c-safe)">+<span id="val_surplus">0</span> è¬</div>
      <div class="hero-sub">æœˆæ”¶ <span id="val_income" class="privacy-blur">0</span> ï¼ æœˆæ”¯ <span id="val_expense" class="privacy-blur">0</span><br>(å·²è‡ªå‹•æ‰£é™¤æŠ•è³‡åˆ©æ¯)</div>
    </div>

    <div class="hero-card" style="border-top-color: var(--c-warn);">
      <div class="hero-title">ç¸½è² å‚µçµæ§‹</div>
      <div class="hero-val"><span id="val_debt_ratio">0%</span> <small style="font-size:1rem;font-weight:400">è² å‚µæ¯”</small></div>
      <div class="hero-sub">æŠ•è³‡å‚µ <span id="val_invest_debt" class="privacy-blur">0</span> ï½œ ç”Ÿæ´»å‚µ <span id="val_life_debt" class="privacy-blur">0</span></div>
    </div>

    <div class="hero-card" style="border-top-color: var(--c-purple);">
      <div class="hero-title">æŠ•è³‡ç¸½æç›Š</div>
      <div class="hero-val privacy-blur"><span id="val_pl">0</span> è¬</div>
      <div class="hero-sub">ç¸½æŠ•å…¥æˆæœ¬ <span id="val_cost" class="privacy-blur">0</span><br>ç¾å€¼ <span id="val_invest_assets" class="privacy-blur">0</span></div>
    </div>
  </div>

  <!-- 2. åœ–è¡¨å€ -->
  <div class="charts-grid">
    <div class="chart-card">
      <h3 style="margin:0 0 10px 0; font-size:1rem;">è³‡ç”¢é…ç½® (å«æˆ¿ç”¢)</h3>
      <div class="chart-box"><canvas id="assetChart"></canvas></div>
    </div>
    <div class="chart-card">
      <h3 style="margin:0 0 10px 0; font-size:1rem;">æ”¶æ”¯çµæ§‹ (å †ç–Šåˆ†æ)</h3>
      <div class="chart-box"><canvas id="flowChart"></canvas></div>
    </div>
  </div>

  <div class="main-layout">
    
    <!-- å·¦å´ï¼šè©³ç´°è³‡ç”¢è² å‚µè¡¨ -->
    <div class="main-content">
      
      <!-- è‚¡ç½æ¨¡æ“¬æ§åˆ¶å€ -->
      <div class="sim-control">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <strong style="color:var(--c-danger)"><i class="fas fa-chart-line"></i> å¸‚å ´å£“åŠ›æ¸¬è©¦æ¨¡æ“¬ (æ»‘æ¡¿)</strong>
            <span style="background:#fff; padding:2px 8px; border-radius:4px; font-weight:bold; border:1px solid #ccc;">
                å‡è¨­è·Œå¹…ï¼š<span id="sim_label" style="color:var(--c-danger); font-size:1.1rem;">0%</span>
            </span>
        </div>
        <div class="range-wrap">
            <span style="font-size:0.8rem;">0%</span>
            <input type="range" id="sim_slider" min="0" max="60" step="1" value="0" oninput="calc()">
            <span style="font-size:0.8rem;">-60%</span>
        </div>
        <div style="font-size:0.8rem; color:var(--text-sub);">
            * æ‹–å‹•æ»‘æ¡¿ï¼Œä¸‹æ–¹è¡¨æ ¼èˆ‡æ°´ä½åœ–å°‡å³æ™‚æ¨¡æ“¬è·Œå¾Œç‹€æ³ã€‚
        </div>
      </div>

      <!-- è³‡ç”¢ç›£æ§è¡¨ (å«æ°´ä½åœ–) -->
      <div class="section-card">
        <div class="section-title">
          <span>ğŸ›¡ï¸ è³‡ç”¢æŠ—è·Œæ°´ä½èˆ‡é¢¨éšªè©³è¡¨</span>
        </div>
        <div class="table-container">
          <table class="asset-table">
            <thead>
              <tr>
                <th style="width:18%">é …ç›® / è¦å®š</th>
                <th>ç¾å€¼ / æˆæœ¬</th>
                <th>å€Ÿæ¬¾ / åˆ©ç‡(%)</th>
                <th style="width:35%; background:rgba(59,130,246,0.02)">é¢¨éšªç¾æ³ (è§¸ç™¼åƒ¹ä½ & æ°´ä½åœ–)</th>
                <th style="width:15%; background:rgba(239,68,68,0.05)">æ¨¡æ“¬çµæœ</th>
              </tr>
            </thead>
            <tbody>
              <!-- ä¿å–® A -->
              <tr>
                <td>
                  <b>ä¿å–® A</b> (æ³•å·´å¹´é‡‘)<br>
                  <span class="rule-tag">è£œç¹³80% / æ–·é ­90%</span>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="asset_a" type="number" value="47" oninput="calc()" placeholder="ç¾å€¼">
                    <input id="cost_a" type="number" value="50" oninput="calc()" placeholder="æˆæœ¬" style="opacity:0.7">
                  </div>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="loan_a" type="number" value="21.5" oninput="calc()" placeholder="å€Ÿæ¬¾">
                    <div style="display:flex; align-items:center; gap:2px;">
                        <input id="rate_a" type="number" value="4.0" class="sm" oninput="calc()"> <span style="font-size:0.7rem">%</span>
                    </div>
                  </div>
                </td>
                <td style="background:rgba(59,130,246,0.02)"><div id="status_a"></div></td>
                <td style="background:rgba(239,68,68,0.02)"><div id="sim_res_a"></div></td>
              </tr>
              
              <!-- ä¿å–® B -->
              <tr>
                <td>
                  <b>ä¿å–® B</b> (æ³•å·´å£½éšª)<br>
                  <span class="rule-tag">è£œç¹³80% / æ–·é ­90%</span>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="asset_b" type="number" value="146" oninput="calc()">
                    <input id="cost_b" type="number" value="150" oninput="calc()" style="opacity:0.7">
                  </div>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="loan_b" type="number" value="68.5" oninput="calc()">
                    <div style="display:flex; align-items:center; gap:2px;">
                        <input id="rate_b" type="number" value="4.0" class="sm" oninput="calc()"> <span style="font-size:0.7rem">%</span>
                    </div>
                  </div>
                </td>
                <td style="background:rgba(59,130,246,0.02)"><div id="status_b"></div></td>
                <td style="background:rgba(239,68,68,0.02)"><div id="sim_res_b"></div></td>
              </tr>

              <!-- ä¿å–® C -->
              <tr>
                <td>
                  <b>ä¿å–® C</b> (å®‰é”å¹´é‡‘)<br>
                  <span class="rule-tag">è£œç¹³80% / æ–·é ­90%</span>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="asset_c" type="number" value="178" oninput="calc()">
                    <input id="cost_c" type="number" value="173" oninput="calc()" style="opacity:0.7">
                  </div>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="loan_c" type="number" value="84" oninput="calc()">
                    <div style="display:flex; align-items:center; gap:2px;">
                        <input id="rate_c" type="number" value="4.0" class="sm" oninput="calc()"> <span style="font-size:0.7rem">%</span>
                    </div>
                  </div>
                </td>
                <td style="background:rgba(59,130,246,0.02)"><div id="status_c"></div></td>
                <td style="background:rgba(239,68,68,0.02)"><div id="sim_res_c"></div></td>
              </tr>

              <!-- ä¿å–® D -->
              <tr>
                <td>
                  <b>ä¿å–® D</b> (å®‰è¯ä¸»åŠ›)<br>
                  <span class="rule-tag">è£œç¹³60% / æ–·é ­70%</span>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="asset_d" type="number" value="324" oninput="calc()">
                    <input id="cost_d" type="number" value="301" oninput="calc()" style="opacity:0.7">
                  </div>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="loan_d" type="number" value="90" oninput="calc()">
                    <div style="display:flex; align-items:center; gap:2px;">
                        <input id="rate_d" type="number" value="4.0" class="sm" oninput="calc()"> <span style="font-size:0.7rem">%</span>
                    </div>
                  </div>
                </td>
                <td style="background:rgba(59,130,246,0.02)"><div id="status_d"></div></td>
                <td style="background:rgba(239,68,68,0.02)"><div id="sim_res_d"></div></td>
              </tr>

              <!-- ETF -->
              <tr style="background:rgba(59,130,246,0.03)">
                <td>
                  <b>å°è‚¡ ETF</b> (è³ªæŠ¼)<br>
                  <span class="rule-tag">è¿½ç¹³ç·š ç¶­æŒç‡130%</span>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="asset_etf" type="number" value="173" oninput="calc()">
                    <input id="cost_etf" type="number" value="160" oninput="calc()" style="opacity:0.7">
                  </div>
                </td>
                <td>
                  <div class="inp-group">
                    <input id="loan_etf" type="number" value="40" oninput="calc()">
                    <div style="display:flex; align-items:center; gap:2px;">
                        <input id="rate_etf" type="number" value="2.5" class="sm" oninput="calc()"> <span style="font-size:0.7rem">%</span>
                    </div>
                  </div>
                </td>
                <td style="background:rgba(59,130,246,0.02)"><div id="status_etf"></div></td>
                <td style="background:rgba(239,68,68,0.02)"><div id="sim_res_etf"></div></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- æˆ¿ç”¢èˆ‡è² å‚µæœ¬é‡‘ -->
      <div class="section-card">
        <div class="section-title">ğŸ  æˆ¿ç”¢èˆ‡ç”Ÿæ´»è² å‚µ (æœ¬é‡‘æ­¸æˆ¶)</div>
        <div style="display:flex; gap:20px; flex-wrap:wrap;">
            
            <div style="flex:1; min-width:200px; border-right:1px solid #eee; padding-right:20px;">
                <h4 style="margin:0 0 10px 0; color:var(--text-sub)">æˆ¿ç”¢ä¼°å€¼</h4>
             
